# タイチョー Strategy 評価シート

タイチョー（実行隊長）は Strategy パターンで実装を差し替え可能。
各チーム（Strategy）を同じ基準で評価し、Issue の難易度に応じた最適な編成を探る。

## 評価指標

### 定量指標（自動計測可能）

| 指標 | 計測方法 | 単位 |
|------|---------|------|
| **PRマージ率** | マージされた Draft PR / 生成された Draft PR | % |
| **コスト** | `cost-tracker.ts` の `costUsd` | USD |
| **所要時間** | `durationMs` | 秒 |
| **リトライ回数** | `retryCount` | 回 |
| **トークン効率** | コスト / 変更行数 | USD/line |
| **ビルド通過率** | CI が通った PR / 全 PR | % |
| **テスト通過率** | テストが通った PR / 全 PR | % |

### 定性指標（人間レビュー）

| 指標 | 評価方法 | スケール |
|------|---------|---------|
| **手直し量** | マージ前に人間が追加したコミット数 | 少ない=良 |
| **レビュー指摘数** | PR レビューのコメント数 | 少ない=良 |
| **要件カバレッジ** | Issue のチェックリスト消化率 | % |
| **デグレ率** | マージ後に発生したバグ / マージ数 | % |
| **コード品質** | 不要な変更、冗長なコードの有無 | 主観 1-5 |

## 難易度分類

| レベル | 説明 | 例 |
|-------|------|-----|
| **S (Simple)** | 1ファイル、数行の変更 | typo修正、設定値変更、文言修正 |
| **M (Medium)** | 2-5ファイル、既存パターンに沿った追加 | 新コマンド追加、既存機能の拡張 |
| **L (Large)** | 5-10ファイル、新パターンの導入 | 新機能追加、リファクタリング |
| **XL (Extra Large)** | 10ファイル以上、アーキテクチャ変更 | 基盤刷新、大規模リファクタ |

## Strategy 一覧

### 1. `claude-cli` (チーム1号)

| 項目 | 内容 |
|------|------|
| **コンセプト** | Claude CLI (`claude -p`) を1ショットで呼び出すシンプル構成 |
| **実装** | `src/agents/taicho/strategies/claude-cli.ts` |
| **LLM** | Claude CLI (sonnet) |
| **ツール** | Bash, Read, Write, Edit, Glob, Grep |
| **実行環境** | ホストマシン直接（プロジェクトの localPath） |
| **予算制御** | `config.taicho.maxBudgetUsd` |
| **タイムアウト** | `config.taicho.timeoutMs` (デフォルト 30分) |
| **想定難易度** | S〜M |

**強み:**
- セットアップ不要、最もシンプル
- Claude CLI の全ツールが使える
- 既存パターンに沿った実装が得意

**弱み:**
- 1ショットなので複雑なタスクで迷走しやすい
- ホスト直接実行のためサンドボックスなし
- 長時間タスクでタイムアウトする可能性

### 評価ログ

| 日付 | Issue | 難易度 | 結果 | コスト | 時間 | リトライ | 手直し | メモ |
|------|-------|--------|------|--------|------|---------|--------|------|
| - | - | - | - | - | - | - | - | 評価開始前 |

---

### 2. `orchestrator-workers` (チーム2号)

| 項目 | 内容 |
|------|------|
| **コンセプト** | Anthropic「Building effective agents」の Orchestrator-Workers パターン。1つのオーケストレーターが計画、複数のワーカーが実行 |
| **実装** | `src/agents/taicho/strategies/orchestrator-workers.ts` |
| **LLM呼び出し** | 最低3回（計画 → ワーカー×N → 検証） |
| **ツール** | 計画: Read/Glob/Grep のみ、ワーカー: 全ツール、検証: Bash/Read |
| **予算配分** | 計画20% / ワーカー70% / 検証10% |
| **想定難易度** | M〜L |

**強み:**
- 計画と実行の分離により、各ワーカーが集中できる
- タスク分解で複雑な Issue も論理的に処理
- 計画段階でコードベースを先に探索するため、的外れな実装が減る

**弱み:**
- LLM呼び出し回数が増えるため、コストが高い
- 計画のJSON出力が不正な場合のフォールバックに依存
- ワーカー間の連携は暗黙的（前のワーカーのコミットを後続が見る）

### 評価ログ

| 日付 | Issue | 難易度 | 結果 | コスト | 時間 | リトライ | 手直し | メモ |
|------|-------|--------|------|--------|------|---------|--------|------|
| - | - | - | - | - | - | - | - | 評価開始前 |

---

### 3. `shogun` (チーム3号)

| 項目 | 内容 |
|------|------|
| **コンセプト** | multi-agent-shogun を参考にした戦国軍制3層構造。軍師（分析）→ 家老（分解）→ 足軽（実行）→ 軍師（検閲） |
| **実装** | `src/agents/taicho/strategies/shogun.ts` |
| **LLM呼び出し** | 最低4回（軍師偵察 → 家老分解 → 足軽×N → 軍師検閲） |
| **ツール** | 軍師: Read/Glob/Grep、家老: Read/Glob/Grep、足軽: 全ツール、軍師検閲: 全ツール |
| **予算配分** | 偵察10% / 分解10% / 実行65% / 検閲15% |
| **想定難易度** | L〜XL |

**強み:**
- 分析と計画が分離（軍師 ≠ 家老）でより精密な計画
- 軍師が最初（偵察）と最後（検閲）の2回登場し、品質を二重チェック
- 家老が依存関係を明示的に管理
- 足軽は前のタスク結果を引き継ぐため、一貫性が高い

**弱み:**
- 最もLLM呼び出し回数が多く、コスト最大
- 4フェーズのため所要時間が長い
- 各フェーズの出力品質に全体が依存する

**orchestrator-workers との違い:**
- orchestrator-workers: 計画1人 + 実行N人 + 検証1人（3層）
- shogun: 偵察1人 + 計画1人 + 実行N人 + 検閲1人（4層、分析と計画が分離）

### 評価ログ

| 日付 | Issue | 難易度 | 結果 | コスト | 時間 | リトライ | 手直し | メモ |
|------|-------|--------|------|--------|------|---------|--------|------|
| - | - | - | - | - | - | - | - | 評価開始前 |

---

### 4. `enterprise` (チーム4号)

| 項目 | 内容 |
|------|------|
| **コンセプト** | 企業組織を模した6層階層構造。PMO（意図解釈）→ Architect（設計）→ PM（計画）→ Coder×N（実装）→ Tester（品質保証）→ PM（統合レビュー） |
| **実装** | `src/agents/taicho/strategies/enterprise.ts` |
| **LLM呼び出し** | 最低6回（PMO → Architect → PM計画 → Coder×N → Tester → PM統合レビュー） |
| **ツール** | PMO: Read/Glob/Grep、Architect: Read/Glob/Grep、PM: Read/Glob/Grep、Coder: 全ツール、Tester: 全ツール、PM統合: 全ツール |
| **予算配分** | PMO 5% / Architect 10% / PM計画 10% / Coder群 50% / Tester 15% / PM統合 10% |
| **想定難易度** | L〜XL |

**強み:**
- PMO が Issue の意図を構造化された要件定義に翻訳（他にはない意図解釈層）
- Architect が設計専門（shogun の軍師は偵察寄り、こちらは設計寄り）
- Tester が品質保証専門（コードレビュー + テスト実行を分離）
- PM が計画と最終統合の2回登場し、要件充足を一貫してチェック
- Coder に受け入れ基準と設計書が渡されるため、品質基準が明確

**弱み:**
- 6フェーズで最もLLM呼び出し回数が多い
- フェーズ間の情報伝達にロスが生じる可能性
- PMO の要件解釈が的外れだと後続全体に影響
- コストと所要時間が最大

**他 Strategy との違い:**
- orchestrator-workers: 計画1人 + 実行N人 + 検証1人（3層）
- shogun: 偵察1人 + 計画1人 + 実行N人 + 検閲1人（4層）
- enterprise: PMO1人 + 設計1人 + PM1人 + 実装N人 + テスト1人 + PM統合1人（6層、意図解釈と設計が独立）

### 評価ログ

| 日付 | Issue | 難易度 | 結果 | コスト | 時間 | リトライ | 手直し | メモ |
|------|-------|--------|------|--------|------|---------|--------|------|
| - | - | - | - | - | - | - | - | 評価開始前 |

---

## Strategy 比較表

| 指標 | claude-cli | orchestrator-workers | shogun | enterprise |
|------|-----------|---------------------|--------|-----------|
| LLM呼び出し回数 | 1 | 3+N | 4+N | 6+N |
| 予想コスト | 低 | 中 | 高 | 最高 |
| 予想所要時間 | 短 | 中 | 長 | 最長 |
| 計画の精度 | なし | 中 | 高（偵察+分解が分離） | 最高（PMO+Architect+PM） |
| 品質チェック | なし | 検証のみ | 偵察+検閲の二重チェック | Tester+PM統合の二重チェック |
| 意図解釈 | なし | なし | なし | PMO が構造化 |
| 設計フェーズ | なし | なし | 偵察（軽量） | Architect（本格設計） |
| 想定難易度 | S〜M | M〜L | L〜XL | L〜XL |

*新しい Strategy を追加したら、このドキュメントにセクションと比較表を更新する。*
